<html>
  <head>
    <title>Chat</title>
    <style>
      input {
        display: block;
      }
      ul {
        list-style: none;
      }
    </style>
    <script>
      let socket;

      document.addEventListener("DOMContentLoaded", () => {
        const messageBox = document.getElementById("messages");
        const chatBox = document.getElementById("chatbox");
        const input = chatBox.querySelector("textarea");

        socket = new WebSocket("ws://localhost:8080/chatRoom");

        chatBox.addEventListener("submit", (e) => {
          e.preventDefault();
          if (input.value && socket.readyState === WebSocket.OPEN) {
            const message = {
              Message: input.value,
            };
            socket.send(JSON.stringify(message));
            input.value = "";
          }
        });

        socket.addEventListener("message", (event) => {
          const newMessage = document.createElement("li");
          const msgData = JSON.parse(event.data);
          console.log("receiving this", JSON.stringify(msgData))
          newMessage.innerText = `${msgData.Name}- ${msgData.When}: ${msgData.Message}`;
          messageBox.appendChild(newMessage);
        });

        socket.addEventListener("close", () => {
          const notice = document.createElement("li");
          notice.innerText = "Connection closed.";
          notice.style.color = "red";
          messageBox.appendChild(notice);
        });

        socket.addEventListener("error", (err) => {
          console.error("WebSocket error:", err);
        });
      });
    </script>
  </head>
  <body>
    <ul id="messages"></ul>
    <form id="chatbox">
      {{.UserData.name}}:<br />
      <textarea></textarea>
      <input type="submit" value="send" />
    </form>
  </body>
</html>
